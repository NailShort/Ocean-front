import{aA as v,b3 as m,aN as d,k as f,l as b,m as s,d as i,Q as u,F as C,aO as $,a8 as r,b0 as q,aK as y,ab as I,ac as S,aY as h,bg as D,y as F,b2 as U,t as L,u as A}from"./index.3e86bd75.js";import{Q as B}from"./QFile.2c76aa0e.js";import{Q as N}from"./QForm.401504b9.js";import{_ as P}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.2a3572e1.js";const w=c=>(L("data-v-76af4cee"),c=c(),A(),c),z={id:"Admin"},Y={class:"content justify-center",align:"center"},j={class:"top col-12 row"},E=w(()=>s("div",{class:"col-8"},[s("h4",{class:"title"},"\u6700\u65B0\u6D88\u606F\u7BA1\u7406")],-1)),K={class:"new col-4 q-pa-md q-gutter-sm"},M=w(()=>s("thead",null,[s("tr",{align:"left"},[s("th",null,"\u5716\u7247"),s("th",null,"\u6A19\u984C"),s("th",null,"\u65E5\u671F"),s("th",null,"\u7BA1\u7406")])],-1)),O={class:"img"},G=["src"],H={class:"name"},J={class:"time"},R={class:"btn"},T={class:"text-h6"},W={__name:"LatestsPage",setup(c){const p={required(a){return!!a||"\u6B04\u4F4D\u5FC5\u586B"}},n=v([]),e=v({_id:"",name:"",time:"",description:"",image:void 0,sell:!1,loading:!1,dialog:!1,idx:-1}),_=new Date,x=`${_.getFullYear()}\u5E74${_.getMonth()+1}\u6708${_.getDate()}\u65E5`,V=a=>{a===-1?(e._id="",e.name="",e.time=x,e.description="",e.image=void 0,e.sell=!1,e.loading=!1,e.idx=-1):(e._id=n[a]._id,e.name=n[a].name,e.time=n[a].time,e.description=n[a].description,e.image=void 0,e.sell=n[a].sell,e.loading=!1,e.idx=a),e.dialog=!0},Q=async()=>{var l,t;e.loading=!0;const a=new FormData;a.append("name",e.name),a.append("time",e.time),a.append("description",e.description),a.append("image",e.image),a.append("sell",e.sell);try{if(e._id.length===0){const{data:o}=await m.post("/latests",a);n.push(o.result),d.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:o}=await m.patch("/latests/"+e._id,a);n[e.idx]=o.result,d.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(o){d.fire({icon:"error",title:"\u5931\u6557",text:((t=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:t.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1},k=async a=>{var l,t;try{await m.delete(`/latests/${a}`);const o=n.findIndex(g=>g._id===a);n.splice(o,1),d.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}catch(o){d.fire({icon:"error",title:"\u5931\u6557",text:((t=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:t.message)||"\u767C\u751F\u932F\u8AA4"})}};return(async()=>{var a,l;try{const{data:t}=await m.get("/latests/all");n.push(...t.result)}catch(t){d.fire({icon:"error",title:"\u5931\u6557",text:((l=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(a,l)=>(f(),b("div",z,[s("div",Y,[s("div",j,[E,s("div",K,[i(u,{label:"\u65B0\u589E\u6D88\u606F",color:"primary",onClick:l[0]||(l[0]=t=>V(-1))})])]),s("table",null,[M,s("tbody",null,[(f(!0),b(C,null,$(n,(t,o)=>(f(),b("tr",{key:t._id},[s("td",O,[s("img",{src:t.image,width:100},null,8,G)]),s("td",H,y(t.name),1),s("td",J,y(t.time),1),s("td",R,[i(u,{round:"",color:"primary",icon:"edit",onClick:g=>V(o)},null,8,["onClick"]),i(u,{round:"",color:"red",icon:"delete",onClick:g=>k(t._id)},null,8,["onClick"])])]))),128))])]),i(q,{modelValue:e.dialog,"onUpdate:modelValue":l[7]||(l[7]=t=>e.dialog=t),persistent:""},{default:r(()=>[i(I,{style:{width:"100%"}},{default:r(()=>[i(N,{onSubmit:Q},{default:r(()=>[i(S,null,{default:r(()=>[s("div",T,y(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1),i(h,{filled:"",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),label:"\u6A19\u984C",hint:"","lazy-rules":"",rules:[p.required]},null,8,["modelValue","rules"]),i(h,{filled:"",modelValue:e.time,"onUpdate:modelValue":l[2]||(l[2]=t=>e.time=t),label:"\u6642\u9593","lazy-rules":"",rules:[p.required]},null,8,["modelValue","rules"]),i(h,{filled:"",modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=t=>e.description=t),autogrow:"",label:"\u5167\u5BB9",rules:[p.required]},null,8,["modelValue","rules"]),i(D,{modelValue:e.sell,"onUpdate:modelValue":l[4]||(l[4]=t=>e.sell=t),label:"\u4E0A\u67B6"},null,8,["modelValue"]),i(B,{outlined:"",modelValue:e.image,"onUpdate:modelValue":l[5]||(l[5]=t=>e.image=t)},{prepend:r(()=>[i(F,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1}),i(U,{align:"center",class:"text-primary"},{default:r(()=>[i(u,{disabled:e.loading,type:"submit",color:"primary",label:"\u9001\u51FA"},null,8,["disabled"]),i(u,{disabled:e.loading,onClick:l[6]||(l[6]=t=>e.dialog=!1),label:"\u53D6\u6D88",color:"primary",flat:"",class:"q-ml-sm"},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}};var ae=P(W,[["__scopeId","data-v-76af4cee"]]);export{ae as default};
